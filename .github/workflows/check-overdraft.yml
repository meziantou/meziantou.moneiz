name: Check Account Overdraft

on:
  workflow_call:
    inputs:
      database-path:
        description: 'Path to the database file'
        required: true
        type: string
      account-ids:
        description: 'Account IDs to check, space or comma-separated (e.g., "1 2 3" or "1,2,3"). If not provided, all accounts will be checked.'
        required: false
        type: string
        default: ''
      overdraft-period-days:
        description: 'Number of days to project into the future'
        required: true
        type: number
      minimum-balance:
        description: 'Minimum balance threshold (default: 0)'
        required: false
        type: number
        default: 0

jobs:
  check-overdraft:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v6

      - name: Setup .NET
        uses: actions/setup-dotnet@v5
        with:
          dotnet-version: '10.0.x'

      - name: Install Meziantou.Moneiz tool
        run: dotnet tool update --global Meziantou.Moneiz.Cli

      - name: Check for overdraft
        shell: pwsh
        run: |
          if ([string]::IsNullOrEmpty("${{ inputs.account-ids }}")) {
            meziantou.moneiz --file "${{ inputs.database-path }}" --days ${{ inputs.overdraft-period-days }} --minimum-balance ${{ inputs.minimum-balance }}
          } else {
            meziantou.moneiz --file "${{ inputs.database-path }}" --account-id "${{ inputs.account-ids }}" --days ${{ inputs.overdraft-period-days }} --minimum-balance ${{ inputs.minimum-balance }}
          }
