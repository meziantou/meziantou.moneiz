name: Check Account Overdraft

on:
  workflow_call:
    inputs:
      database-path:
        description: 'Path to the database file'
        required: true
        type: string
      account-ids:
        description: 'Account IDs to check, space or comma-separated (e.g., "1 2 3" or "1,2,3"). If not provided, all accounts with notifications enabled will be checked.'
        required: false
        type: string
        default: ''

jobs:
  check-overdraft:
    runs-on: ubuntu-slim

    steps:
      - name: Checkout repository
        uses: actions/checkout@v6

      - name: Setup .NET
        uses: actions/setup-dotnet@v5
        with:
          dotnet-version: '10.0.x'

      - name: Install Meziantou.Moneiz tool
        run: dotnet tool update --global Meziantou.Moneiz.Cli

      - name: Add .NET tools to PATH
        run: echo "$HOME/.dotnet/tools" >> $GITHUB_PATH
        shell: bash

      - name: Check for overdraft
        shell: pwsh
        run: |
          if ([string]::IsNullOrEmpty("${{ inputs.account-ids }}")) {
            meziantou.moneiz --file "${{ inputs.database-path }}"
          } else {
            meziantou.moneiz --file "${{ inputs.database-path }}" --account-id "${{ inputs.account-ids }}"
          }

